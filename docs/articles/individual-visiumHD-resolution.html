<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Individual Resolution in VisiumHD Data • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Individual Resolution in VisiumHD Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Initiating a SPATA2 object</li>
    <li>
      <a href="../articles/initiation-and-preprocessing-customized.html">Initiation &amp; Preprocessing with individual data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-merfish.html">Initiation &amp; Preprocessing with MERFISH data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium.html">Initiation &amp; Preprocessing with Visium data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium-hd.html">Initiation &amp; Preprocessing with VisiumHD data</a>
    </li>
    <li class="dropdown-header">Basic Manipulation of a SPATA2 object</li>
    <li>
      <a href="../articles/adding-data.html">Adding Data to SPATA2 objects</a>
    </li>
    <li>
      <a href="../articles/package-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/molecular-variables.html">Molecular Variables</a>
    </li>
    <li>
      <a href="../articles/image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Implemented Algorithms &amp; Concepts</li>
    <li>
      <a href="../articles/cnv.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/dimensional-reduction.html">Dimensional Reduction</a>
    </li>
    <li>
      <a href="../articles/dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/gsea.html">Gene Set Enrichment</a>
    </li>
    <li>
      <a href="../articles/spatial-measures.html">Spatial Measures</a>
    </li>
    <li class="dropdown-header">Spatial Gradient Screening</li>
    <li>
      <a href="../articles/creating-spatial-annotations.html">Creating Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/using-spatial-annotations.html">Using Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/spatial-annotation-screening.html">Spatial Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/creating-spatial-trajectories.html">Creating Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/plotting-surface.html">Surface Plotting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/newslog.html">Newslog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Individual Resolution in VisiumHD Data</h1>
            
      

      <div class="hidden name"><code>individual-visiumHD-resolution.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>VisiumHD datasets offer an unprecedented level of spatial resolution,
capturing detailed transcriptomic information across tissue sections.
However, the high resolution comes with substantial data sizes, which
can pose challenges in terms of computational resources, data
visualization, and interpretation. In some scenarios, reducing the
resolution of the data by aggregating nearby barcodes (spatial spots)
into fewer, larger groups is beneficial. This process not only makes the
data more manageable but can also help highlight broader spatial
patterns and reduce noise.</p>
<p>In this tutorial, we will walk through how to reduce the resolution
of a VisiumHD dataset to a user defined resolution that deviates from
the standard output provided by 10X Genomics (16um, 8um and 2um). We’ll
use the <code><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD()</a></code> function from the SPATA2
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SPATAData</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the SPATA2 example object</span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/downloadSpataObject.html">downloadSpataObject</a></span><span class="op">(</span><span class="st">"HumanPancreasHD"</span>, update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show object</span></span>
<span><span class="va">object</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class SPATA2</span></span>
<span><span class="co">## Sample: HumanPancreasHD </span></span>
<span><span class="co">## Size: 106574 x 18085 (spots x molecules)</span></span>
<span><span class="co">## Memory: 663.77 Mb</span></span>
<span><span class="co">## Platform: VisiumHD (Resolution: 16um) </span></span>
<span><span class="co">## Molecular assays (1):</span></span>
<span><span class="co">## 1. Assay</span></span>
<span><span class="co">##  Molecular modality: gene</span></span>
<span><span class="co">##  Distinct molecules: 18085</span></span>
<span><span class="co">##  Matrices (1):</span></span>
<span><span class="co">##  -counts (active)</span></span>
<span><span class="co">## Registered images (2):</span></span>
<span><span class="co">## - hires (6000x5968 px, not loaded)</span></span>
<span><span class="co">## - lowres (600x597 px, active, loaded)</span></span>
<span><span class="co">## Meta variables (2): sample, tissue_section</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="the-concept">2. The concept<a class="anchor" aria-label="anchor" href="#the-concept"></a>
</h2>
<p>The example object has a resolution of 16um. We can create grid
layers that represent different resolutions. Note that the slight tilt
of these grids derives from a slight tilt of the visium spots when
visualized in pixel units.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># resolution = 32um</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"32um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Resolution: 32um"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resolution = 64um</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"64um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Resolution: 64um"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resolution = 128um</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"128um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Resolution: 128um"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resolution = 256um</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"256um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Resolution: 256um"</span><span class="op">)</span></span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-3-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-3-2.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-3-3.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-3-4.png" width="50%"></p>
<p>Assuming that the data size surpasses the limits of a computational
approach we’d like to conduct, lets reduce the resolution of this object
from 16um to 32um. The figure below visualizes the concept and what the
new resolution would look like.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create some additional ggplot layers</span></span>
<span><span class="co"># for a closer look</span></span>
<span><span class="va">grid_layer_zoomed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"32um"</span>, line_size <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for length reference (&amp; proof of principle)</span></span>
<span><span class="va">scale_bar_layer</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerScaleBarSI.html">ggpLayerScaleBarSI</a></span><span class="op">(</span><span class="va">object</span>, sb_dist <span class="op">=</span> <span class="st">"32um"</span>, sb_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5.75mm"</span>, <span class="st">"6.15mm"</span><span class="op">)</span>, text_nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define axes of the example zone to focus on</span></span>
<span><span class="va">xrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5.5mm"</span>, <span class="st">"6mm"</span><span class="op">)</span></span>
<span><span class="va">yrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"6mm"</span>, <span class="st">"6.5mm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># left plot</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object</span>, res <span class="op">=</span> <span class="st">"32um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerRect.html">ggpLayerRect</a></span><span class="op">(</span><span class="va">object</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span><span class="op">)</span> <span class="co"># we zoom in here</span></span>
<span></span>
<span><span class="co"># right plot</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.1</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">grid_layer_zoomed</span> <span class="op">+</span></span>
<span>  <span class="va">scale_bar_layer</span></span></code></pre></div>
<div class="figure">
<img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-4-1.png" alt="SPATA2 VisiumHD object with a resolution of 16um. On the right, zoomed in, a grid is visualized that indicates how the new resolution of 32um would look like." width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-4-2.png" alt="SPATA2 VisiumHD object with a resolution of 16um. On the right, zoomed in, a grid is visualized that indicates how the new resolution of 32um would look like." width="50%"><p class="caption">
SPATA2 VisiumHD object with a resolution of 16um. On the right, zoomed
in, a grid is visualized that indicates how the new resolution of 32um
would look like.
</p>
</div>
</div>
<div class="section level2">
<h2 id="application">3. Application<a class="anchor" aria-label="anchor" href="#application"></a>
</h2>
<p>For the sake of this example we reduce the number of genes in this
object to 100 as it speeds up the processing time dramatically. This is
not required, however. The function works with as many genes your object
contains - just slower.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify top 100 genes for the sake of this example</span></span>
<span><span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyVariableMolecules.html">identifyVariableMolecules</a></span><span class="op">(</span><span class="va">object</span>, method <span class="op">=</span> <span class="st">"vst"</span>, n_mol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">genes_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVariableMolecules.html">getVariableMolecules</a></span><span class="op">(</span><span class="va">object</span>, method <span class="op">=</span> <span class="st">"vst"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">genes_keep</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  chr [1:100] "INS" "REG3A" "TTR" "GCG" "GHRL" "SST" "VIP" "PPY" "CARTPT" ...</span></span></code></pre>
<p>You can further improve processing time by increasing the number of
workers. E.g. <code>workers = 4</code> would occupy four cores for
parallel processing. Set the parameter to your liking.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reduce resolution</span></span>
<span><span class="va">object_32um</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">object</span>, </span>
<span>    res_new <span class="op">=</span> <span class="st">"32um"</span>, </span>
<span>    genes <span class="op">=</span> <span class="va">genes_keep</span>, </span>
<span>    workers <span class="op">=</span> <span class="fl">1</span> <span class="co"># &gt;1 uses the furrr package </span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># show object</span></span>
<span><span class="va">object_32um</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class SPATA2</span></span>
<span><span class="co">## Sample: HumanPancreasHD_redResHD </span></span>
<span><span class="co">## Size: 27300 x 100 (spots x molecules)</span></span>
<span><span class="co">## Memory: 103.94 Mb</span></span>
<span><span class="co">## Platform: VisiumHD (Resolution: 32um) </span></span>
<span><span class="co">## Molecular assays (1):</span></span>
<span><span class="co">## 1. Assay</span></span>
<span><span class="co">##  Molecular modality: gene</span></span>
<span><span class="co">##  Distinct molecules: 100</span></span>
<span><span class="co">##  Matrices (1):</span></span>
<span><span class="co">##  -counts (active)</span></span>
<span><span class="co">## Registered images (2):</span></span>
<span><span class="co">## - hires (6000x5968 px, not loaded)</span></span>
<span><span class="co">## - lowres (600x597 px, active, loaded)</span></span>
<span><span class="co">## Meta variables (5): sample, square_exp, square_count, square_perc, tissue_section</span></span></code></pre>
<p>Note how the number of observations as well as the resolution
indicated behind the platform name has changed. Furthermore, note the
additional meta variables in the object <em>square_count</em> and
<em>square_perc</em> giving information about the aggregation process.
See below under 4. Meta data of the reduction process.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># left plot for orientation</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_32um</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerRect.html">ggpLayerRect</a></span><span class="op">(</span><span class="va">object_32um</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># right plot</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_32um</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">grid_layer_zoomed</span> <span class="op">+</span> </span>
<span>  <span class="co">#ggpLayerGridVisiumHD(object_32um, "32um", line_clr = "green") +</span></span>
<span>  <span class="va">scale_bar_layer</span></span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-8-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-8-2.png" width="50%">
Moreover, you can initiate the <code>SPATA2</code> object directly with
the resolution you require. The input for argument
<code>square_res</code> can deviate from the standard output as long as
it is an even number - devisable by either of the standard resolution
options, that is 16um, 4um or 2um. In that case, data from the next
possible lower resolution is read in and
<code><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD()</a></code> is applied. E.g. if square_res =
‘4um’, data is taken from ~/binned_outputs/square_002um and then
aggregated accordingly. If ⁠square_res = 10um⁠, the same is the case. If
⁠square_res = 24um⁠, data is read in from ~/binned_outputs/square_008um,
if ⁠square_res = 32um⁠, data is read in from
~/binned_outputs/square_016um. Note, that aggregating counts by
resolution can take a considerable amount of time. Consider prefiltering
the raw counts using right from the beginning using <code>genes</code>
and/or increasing the number of cores to use with argument
<code>workers</code>.</p>
<p>For instance, initiating the object as indicated below looks for
either the 8um folder or, if not available, the 2um folder. The object
is initiated and the resolution is immediately reduced before being
returned by the initiation function. If you have not already download
the data, acces the dataset <a href="https://www.10xgenomics.com/datasets/visium-hd-cytassist-gene-expression-libraries-human-pancreas" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">object_24um</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/initiateSpataObjectVisiumHD.html">initiateSpataObjectVisiumHD</a></span><span class="op">(</span></span>
<span>    sample_name <span class="op">=</span> <span class="st">"PancreasHD_24um"</span>, </span>
<span>    directory_visium <span class="op">=</span> <span class="va">dir</span>,<span class="st">"my/path/to/VisiumHD_Pancreas"</span>, </span>
<span>    square_res <span class="op">=</span> <span class="st">"24um"</span>, </span>
<span>    workers <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    genes <span class="op">=</span> <span class="va">genes_keep</span> <span class="co"># for this example</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">object_24um</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class SPATA2</span></span>
<span><span class="co">## Sample: PancreasHD_24um </span></span>
<span><span class="co">## Size: 48076 x 100 (spots x molecules)</span></span>
<span><span class="co">## Memory: 167.35 Mb</span></span>
<span><span class="co">## Platform: VisiumHD (Resolution: 24um) </span></span>
<span><span class="co">## Molecular assays (1):</span></span>
<span><span class="co">## 1. Assay</span></span>
<span><span class="co">##  Molecular modality: gene</span></span>
<span><span class="co">##  Distinct molecules: 100</span></span>
<span><span class="co">##  Matrices (1):</span></span>
<span><span class="co">##  -counts (active)</span></span>
<span><span class="co">## Registered images (1):</span></span>
<span><span class="co">## - lowres (600x597 px, active, loaded)</span></span>
<span><span class="co">## Meta variables (5): sample, square_exp, square_count, square_perc, tissue_section</span></span></code></pre>
<p>The plots below highlight the new resolution. See 6. Proof of
principle for the validation of this algorithm.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># left plot</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_24um</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object_24um</span>, res <span class="op">=</span> <span class="st">"24um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerRect.html">ggpLayerRect</a></span><span class="op">(</span><span class="va">object</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span><span class="op">)</span> <span class="co"># we zoom in here</span></span>
<span></span>
<span><span class="co"># right plot</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_24um</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.15</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerGridVisiumHD.html">ggpLayerGridVisiumHD</a></span><span class="op">(</span><span class="va">object_24um</span>, res <span class="op">=</span> <span class="st">"24um"</span>, line_size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/ggpLayerScaleBarSI.html">ggpLayerScaleBarSI</a></span><span class="op">(</span><span class="va">object_24um</span>, sb_dist <span class="op">=</span> <span class="st">"24um"</span>, sb_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5.6725mm"</span>, <span class="st">"6.15mm"</span><span class="op">)</span>, text_nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-11-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-11-2.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="merging-back-to-higher-resolution">4. Merging back to higher resolution<a class="anchor" aria-label="anchor" href="#merging-back-to-higher-resolution"></a>
</h2>
<p>Once analysis was conducted on a lower resolution, the results can be
transferred back to the high resolution object using the barcodes of the
reduction process as keys. Use the function
<code><a href="../reference/unwindAggregation.html">unwindAggregation()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># example</span></span>
<span><span class="va">reconstr_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unwindAggregation.html">unwindAggregation</a></span><span class="op">(</span><span class="va">object_32um</span>, var_names <span class="op">=</span> <span class="st">"square_count"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reconstr_df</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 176,400 × 3</span></span></span>
<span><span class="co">##    barcodes              barcodes_aggr square_count</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> s_016um_00000_00000-1 c0r0                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> s_016um_00000_00001-1 c0r0                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> s_016um_00001_00000-1 c0r0                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> s_016um_00001_00001-1 c0r0                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> s_016um_00002_00000-1 c0r1                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> s_016um_00002_00001-1 c0r1                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> s_016um_00003_00000-1 c0r1                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> s_016um_00003_00001-1 c0r1                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> s_016um_00020_00000-1 c0r10                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> s_016um_00020_00001-1 c0r10                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 176,390 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="meta-data-of-the-reduction-process">5. Meta data of the reduction process<a class="anchor" aria-label="anchor" href="#meta-data-of-the-reduction-process"></a>
</h2>
<p>Reducing the resolution increases the diameter of the observations,
the squared spots. If located at the edge of the tissue, this can lead
to these larger squares transgressing the tissue edge, including fewer
spots than those in the center of the tissue. How many spots the new
spots used for aggregation is stored in the meta variables
<em>square_count</em> and <em>square_perc</em> in absolute and relative
terms, respectively.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note how several new squares do not contain 4 but 3 to 1 spots due to the tissue edge</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.1</span>, pt_clr <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">scale_bar_layer</span> <span class="op">+</span> </span>
<span>  <span class="va">grid_layer_zoomed</span></span>
<span></span>
<span><span class="co"># note how several new squares do not contain 4 but 3 to 1 spots due to the tissue edge</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_32um</span>, color_by <span class="op">=</span> <span class="st">"square_count"</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">grid_layer_zoomed</span></span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-13-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-13-2.png" width="50%"></p>
<p>Depending on your overall goal and downstream analysis workflow, you
might want to remove these edge crossing squares. If so, one line of
code does the trick.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter if you want to by referring directly to meta variables</span></span>
<span><span class="va">object_32um_flt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterSpataObject.html">filterSpataObject</a></span><span class="op">(</span><span class="va">object_32um</span>, <span class="va">square_count</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># left plot, not filtered</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_32um</span>, color_by <span class="op">=</span> <span class="st">"square_perc"</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">grid_layer_zoomed</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Not filtered"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rightplot, filtered</span></span>
<span><span class="fu"><a href="../reference/plotSurface.html">plotSurface</a></span><span class="op">(</span><span class="va">object_32um_flt</span>, color_by <span class="op">=</span> <span class="st">"square_perc"</span>, xrange <span class="op">=</span> <span class="va">xrange</span>, yrange <span class="op">=</span> <span class="va">yrange</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, pt_size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">grid_layer_zoomed</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Filtered"</span><span class="op">)</span></span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-14-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-14-2.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="proof-of-principle">6. Proof of principle<a class="anchor" aria-label="anchor" href="#proof-of-principle"></a>
</h2>
<p>To validate this approach, we compare the counts of a
<code>SPATA2</code> VisiumHD object that directly derived from the
<em>~/binned_outs_016um</em> folder with an object whose resolution was
artificially reduced to 16um by
<code><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># intiate the objects with different resolutions</span></span>
<span><span class="va">object_16um</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/initiateSpataObjectVisiumHD.html">initiateSpataObjectVisiumHD</a></span><span class="op">(</span></span>
<span>    sample_name <span class="op">=</span> <span class="st">"PancreasHD_16um"</span>, </span>
<span>    directory_visium <span class="op">=</span> <span class="va">dir</span>,<span class="co">#"my/path/to/VisiumHD_Pancreas", # adjust to your directory</span></span>
<span>    square_res <span class="op">=</span> <span class="st">"16um"</span>, </span>
<span>    genes <span class="op">=</span> <span class="va">genes_keep</span> <span class="co"># reduce size for the sake of this experiment</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">object_8um</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/initiateSpataObjectVisiumHD.html">initiateSpataObjectVisiumHD</a></span><span class="op">(</span></span>
<span>    sample_name <span class="op">=</span> <span class="st">"PancreasHD_8um"</span>, </span>
<span>    directory_visium <span class="op">=</span> <span class="va">dir</span>,<span class="co">#"my/path/to/VisiumHD_Pancreas", </span></span>
<span>    square_res <span class="op">=</span> <span class="st">"8um"</span>,</span>
<span>    genes <span class="op">=</span> <span class="va">genes_keep</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># reduce the 8um object</span></span>
<span><span class="va">object_16um_art</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD</a></span><span class="op">(</span><span class="va">object_8um</span>, res_new <span class="op">=</span> <span class="st">"16um"</span><span class="op">)</span></span></code></pre></div>
<p>Next, we extract the counts of two examples genes, <em>INS</em> and
<em>VIP</em>, and spatial coordinates from the original object and the
artificially reduced object. Furthermore, we suffix the variables from
the artificially created 16um resolution object with *_art*.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">example_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VIP"</span>, <span class="st">"INS"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">counts16um_orig</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/getCoordsDf.html">getCoordsDf</a></span><span class="op">(</span><span class="va">object_16um</span>, variables <span class="op">=</span> <span class="va">example_genes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">barcodes</span>, <span class="va">col</span>, <span class="va">row</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">INS</span>, <span class="va">VIP</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">counts16um_orig</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   barcodes                col   row     x     y   INS   VIP</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> s_016um_00000_00170-1   248     0  354.  120.     0     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> s_016um_00000_00171-1   247     0  353.  120.     2     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> s_016um_00000_00207-1   211     0  329.  120.     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> s_016um_00000_00208-1   210     0  328.  120.     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> s_016um_00000_00209-1   209     0  327.  120.     0     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> s_016um_00000_00210-1   208     0  327.  120.     1     0</span></span>
<span></span>
<span><span class="va">counts16um_art</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/getCoordsDf.html">getCoordsDf</a></span><span class="op">(</span><span class="va">object_16um_art</span>, variables <span class="op">=</span> <span class="va">example_genes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">barcodes</span>, <span class="va">col</span>, <span class="va">row</span>, x_art <span class="op">=</span> <span class="va">x</span>, y_art <span class="op">=</span> <span class="va">y</span>, INS_art <span class="op">=</span> <span class="va">INS</span>, VIP_art <span class="op">=</span> <span class="va">VIP</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">counts16um_art</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   barcodes   col   row x_art y_art INS_art VIP_art</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> c0r269       0   269  187.  304.       0       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> c0r270       0   270  187.  305.       0       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> c0r271       0   271  187.  305.       0       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> c100r0     100     0  253.  121.     130       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> c100r1     100     1  253.  122.      26       0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> c100r10    100    10  253.  128.       0       0</span></span></code></pre></div>
<p>Note, that <code><a href="../reference/reduceResolutionVisiumHD.html">reduceResolutionVisiumHD()</a></code> creates new
barcodes! While it would certainly possible to mimic the 10X naming
convention for VisiumHD, easier is to just join the count data using the
spatial variables <em>col</em> and <em>row</em> as keys.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge both data.frame by col/row key</span></span>
<span><span class="va">df_compare</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">counts16um_orig</span>, </span>
<span>    y <span class="op">=</span> <span class="va">counts16um_art</span>, </span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"col"</span>, <span class="st">"row"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># top left</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_compare</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">INS</span>, y <span class="op">=</span> <span class="va">INS_art</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># top right</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_compare</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VIP</span>, y <span class="op">=</span> <span class="va">VIP_art</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># bottom left</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_compare</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">x_art</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># bottom right </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_compare</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">x_art</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-18-1.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-18-2.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-18-3.png" width="50%"><img src="individual-visiumHD-resolution_files/figure-html/unnamed-chunk-18-4.png" width="50%"></p>
<p>All four plots indicate an almost perfect correlation between the
artificially downscaled data and the real data, proving the validity of
the algorithm. Spatial coordinates are actually exactly the same. For
statistic hardliner the exact correlations:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># INS </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">INS</span>, y <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">INS_art</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  df_compare$INS and df_compare$INS_art</span></span>
<span><span class="co">## t = 36799, df = 106572, p-value &lt; 2.2e-16</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.9999602 0.9999611</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##       cor </span></span>
<span><span class="co">## 0.9999607</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># VIP </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">VIP</span>, y <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">VIP_art</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  df_compare$VIP and df_compare$VIP_art</span></span>
<span><span class="co">## t = 54844, df = 106572, p-value &lt; 2.2e-16</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.9999821 0.9999825</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##       cor </span></span>
<span><span class="co">## 0.9999823</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># x coordinates </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">x_art</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  df_compare$x and df_compare$x_art</span></span>
<span><span class="co">## t = 1.832e+09, df = 106572, p-value &lt; 2.2e-16</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  1 1</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## cor </span></span>
<span><span class="co">##   1</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># y coordinates </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">y</span>, y <span class="op">=</span> <span class="va">df_compare</span><span class="op">$</span><span class="va">y_art</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  df_compare$y and df_compare$y_art</span></span>
<span><span class="co">## t = 2070105284, df = 106572, p-value &lt; 2.2e-16</span></span>
<span><span class="co">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  1 1</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## cor </span></span>
<span><span class="co">##   1</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
