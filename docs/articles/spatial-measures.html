<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Measures • SPATA2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Measures">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPATA2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li>
  <a href="../articles/spata-data.html">SPATAData</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Initiating a SPATA2 object</li>
    <li>
      <a href="../articles/initiation-and-preprocessing-customized.html">Initiation &amp; Preprocessing with individual data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-merfish.html">Initiation &amp; Preprocessing with MERFISH data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium.html">Initiation &amp; Preprocessing with Visium data</a>
    </li>
    <li>
      <a href="../articles/initiation-and-preprocessing-visium-hd.html">Initiation &amp; Preprocessing with VisiumHD data</a>
    </li>
    <li class="dropdown-header">Basic Manipulation of a SPATA2 object</li>
    <li>
      <a href="../articles/adding-data.html">Adding Data to SPATA2 objects</a>
    </li>
    <li>
      <a href="../articles/package-compatibility.html">Platform Compatibility</a>
    </li>
    <li>
      <a href="../articles/molecular-variables.html">Molecular Variables</a>
    </li>
    <li>
      <a href="../articles/image-handling.html">Image Handling</a>
    </li>
    <li>
      <a href="../articles/spatial-segmentation.html">Spatial Segmentation</a>
    </li>
    <li class="dropdown-header">Implemented Algorithms &amp; Concepts</li>
    <li>
      <a href="../articles/cnv.html">Copy Number Variations</a>
    </li>
    <li>
      <a href="../articles/clustering.html">Clustering</a>
    </li>
    <li>
      <a href="../articles/dimensional-reduction.html">Dimensional Reduction</a>
    </li>
    <li>
      <a href="../articles/dea.html">Differential Expression</a>
    </li>
    <li>
      <a href="../articles/gsea.html">Gene Set Enrichment</a>
    </li>
    <li>
      <a href="../articles/spatial-measures.html">Spatial Measures</a>
    </li>
    <li class="dropdown-header">Spatial Gradient Screening</li>
    <li>
      <a href="../articles/creating-spatial-annotations.html">Creating Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/using-spatial-annotations.html">Using Spatial Annotations</a>
    </li>
    <li>
      <a href="../articles/spatial-annotation-screening.html">Spatial Annotation Screening</a>
    </li>
    <li>
      <a href="../articles/creating-spatial-trajectories.html">Creating Spatial Trajectories</a>
    </li>
    <li>
      <a href="../articles/spatial-trajectory-screening.html">Spatial Trajectory Screening</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li>
      <a href="../articles/plotting-surface.html">Surface Plotting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/newslog.html">Newslog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Measures</h1>
            
      

      <div class="hidden name"><code>spatial-measures.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Many questions researchers try to answer in spatial transcriptomics
and image analysis are space related. Coordinates of the observations
are often scaled to the resolution of the image that is currently in
use. In case of the Visium platform, if one exchanges the
<em>tissue_lowres_image.png</em> with the
<em>tissue_hires_image.png</em> from the 10X Visium output, the
coordinates of the barcoded spots are scaled accordingly to ensure that
both, coordinates and image, stay aligned. Thus, coordinates can be used
to answer spatial questions in relative but not in absolute measures.
For instance, the statement: “The necrotic region spans an area of
approximately 400pixels.” is useless. If pixels are used as a unit the
area will always depend on the image resolution. This tutorial explains
how SPATA2 computes the transition from pixel to SI units for the Visium
platform with the pixel scale factor. Furthermore, it gives examples
about how you can leverage working with SI distances.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://themilolab.com/" class="external-link">SPATA2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load SPATA2 inbuilt example data (and rename an image for this tutorial)</span></span>
<span><span class="va">object_t275</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/loadExampleObject.html">loadExampleObject</a></span><span class="op">(</span><span class="st">"UKF275T"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/renameImage.html">renameImage</a></span><span class="op">(</span>img_name <span class="op">=</span> <span class="st">"image1"</span>, new_img_name <span class="op">=</span> <span class="st">"lowres"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">text_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">17.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"lowres"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">text_size</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Normal resolution"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># very_low_res image has been registered using `registerImage()`</span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span>, img_name <span class="op">=</span> <span class="st">"very_low_res"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">text_size</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Very low resolution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-measures_files/figure-html/unnamed-chunk-3-1.png" width="50%"><img src="spatial-measures_files/figure-html/unnamed-chunk-3-2.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="the-pixel-scale-factor">2. The pixel scale factor<a class="anchor" aria-label="anchor" href="#the-pixel-scale-factor"></a>
</h2>
<p>To answer questions in absolute measures, distances must be converted
to units of the <a href="https://en.wikipedia.org/wiki/International_System_of_Units#:~:text=The%20SI%20comprises%20a%20coherent,candela%20(cd%2C%20luminous%20intensity)" class="external-link">*Système
international d’unités (SI)</a>. That is, micrometers, millimeters,
centimeters, etc. This is possible as most spatial -omic studies come
with a ground truth.</p>
<div class="section level3">
<h3 id="visium">2.1 Visium<a class="anchor" aria-label="anchor" href="#visium"></a>
</h3>
<p>In case of <a href="https://kb.10xgenomics.com/hc/en-us/articles/360035487572-What-is-the-spatial-resolution-and-configuration-of-the-capture-area-of-the-Visium-Gene-Expression-Slide-" class="external-link">10X
Visium</a> this ground truth is the center to center distance between
two adjacent barcoded spots which is always 100um. Using this
information, the actual distances and areas can be computed with a pixel
scale factor. This factor is computed automatically by
<code><a href="../reference/initiateSpataObjectVisium.html">initiateSpataObjectVisium()</a></code>.</p>
<p>(If you have multiple images registered in your <code>SPATA2</code>
object, note that, by default, the pixel scale factor from the
<strong>active image</strong> is used.)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># how many um is one pixel in side lengths</span></span>
<span><span class="fu"><a href="../reference/getPixelScaleFactor.html">getPixelScaleFactor</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"um"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 13.68328</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "um/px"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># how many pixel is one um in side lengths</span></span>
<span><span class="fu"><a href="../reference/getPixelScaleFactor.html">getPixelScaleFactor</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"um"</span>, switch <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.07308187</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "px/um"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># by default the pixel scale factor of the active image is used</span></span>
<span><span class="fu"><a href="../reference/getImageNames.html">getImageNames</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "lowres"       "very_low_res"</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># which is image 'lowres' in this example</span></span>
<span><span class="fu"><a href="../reference/activateImage.html">activeImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "lowres"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># how many um is one pixel in side lengths in case of an even lower resolution?</span></span>
<span><span class="fu"><a href="../reference/getPixelScaleFactor.html">getPixelScaleFactor</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"um"</span>, img_name <span class="op">=</span> <span class="st">"very_low_res"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 78.94202</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "um/px"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="merfish-and-co">2.2 MERFISH and Co<a class="anchor" aria-label="anchor" href="#merfish-and-co"></a>
</h3>
<p>The term <em>pixel scale factor</em> derives from a time where SPATA2
was solely thought to work with Visium datasets. It has been expanded to
include other platforms such as MERFISH which provides coordinates of
cells in micrometer units. If the platform provides the coordinates of
its observations in SI units the pixel scale factor theoretically isn’t
required but for the code of SPATA2 to work, such a scale factor must
exist in the <code>SPATA2</code>object. Therefore, it is set
automatically by the respective <code>initiateSpataObject*()</code>
function. E.g. in MERFISH data, the x- and y-coordinates are provided in
um units. Hence, the pixel scale factor of <code>SPATA2</code> objects
initiated with <code><a href="../reference/initiateSpataObjectMERFISH.html">initiateSpataObjectMERFISH()</a></code> is always
<em>1mm/px</em>.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-distances">3. Working with distances<a class="anchor" aria-label="anchor" href="#working-with-distances"></a>
</h2>
<p>Multiple functions take arguments that, in some way, refer to
distance measures. SPATA2 makes use of the <a href="https://github.com/r-quantities/units" class="external-link"><code>units</code></a>
package to work with distances. If not explained otherwise in the
documentation you can provide the distance in pixel or in SI units.
Behind the scenes input is converted to pixel and aligned with the
current resolution. 4.1 Converting distances gives some examples of how
this is done.</p>
<div class="section level3">
<h3 id="handling-distance-input-and-output">3.1 Handling distance input and output<a class="anchor" aria-label="anchor" href="#handling-distance-input-and-output"></a>
</h3>
<p>Every SI unit of length is a valid distance unit.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/validActivationFunctions.html">validUnitsOfLength</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##  nanometer micrometer millimeter centimeter  decimeter      meter      pixel </span></span>
<span><span class="co">##       "nm"       "um"       "mm"       "cm"       "dm"        "m"       "px"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/validActivationFunctions.html">validUnitsOfLengthSI</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">##  nanometer micrometer millimeter centimeter  decimeter      meter </span></span>
<span><span class="co">##       "nm"       "um"       "mm"       "cm"       "dm"        "m"</span></span>
<span></span>
<span><span class="co"># wrappers around units::set_units()</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_micrometer</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"4mm"</span><span class="op">)</span></span>
<span><span class="co">## 4000 [um]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_millimeter</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"4cm"</span><span class="op">)</span></span>
<span><span class="co">## 40 [mm]</span></span></code></pre></div>
<p>Pixel is not a valid distance unit in <code>units</code>. Pixel,
however, are important in image analysis. SPATA2 provides the wrappers
needed to reconcile both. They are named according to the unit of
interest. To transform between pixel and SI units of length the
<code>SPATA2</code> object must be provided as the scale factor is
needed. See the documentation of <code><a href="../reference/is_dist.html">?is_dist</a></code> to obtain more
information on how distance values must be specified.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### convert from si -&gt; pixel</span></span>
<span></span>
<span><span class="co"># example 1: a simple string works</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_pixel</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"4mm"</span>, object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="co">## [1] 292.3275</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "px"</span></span>
<span></span>
<span><span class="co"># example 2: a unit object works, too</span></span>
<span><span class="va">unit_input</span> <span class="op">&lt;-</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">4</span>, value <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unit_input</span></span>
<span><span class="co">## 4 [mm]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">unit_input</span><span class="op">)</span></span>
<span><span class="co">## [1] "units"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_pixel</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">unit_input</span>, object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span></span>
<span><span class="co">## [1] 292.3275</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "px"</span></span>
<span></span>
<span><span class="co">### convert from pixel -&gt; si</span></span>
<span></span>
<span><span class="co"># example 1: simple numeric input is interpreted as pixel</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_millimeter</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span>, </span>
<span>  object <span class="op">=</span> <span class="va">object_t275</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## Units: [mm]</span></span>
<span><span class="co">## [1] 1.368328 2.736657 4.104985</span></span>
<span><span class="co"># example 2: strings with px suffix work, too</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_micrometer</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"50px"</span>, <span class="st">"200px"</span>, <span class="st">"800px"</span><span class="op">)</span>, </span>
<span>  object <span class="op">=</span> <span class="va">object_t275</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Units: [um]</span></span>
<span><span class="co">## [1]   684.1642  2736.6568 10946.6271</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="examples">3.2 Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>The following are a few examples of where actual distances might come
into play.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specifying x- and y-range while handling images</span></span>
<span><span class="va">xrange</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2.5mm"</span>, <span class="st">"6.5mm"</span><span class="op">)</span></span>
<span><span class="va">yrange</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.5mm"</span>, <span class="st">"4.5mm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># where to set the breaks is a measure of distance, too</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">8</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># vector of valid distance inputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0mm" "1mm" "2mm" "3mm" "4mm" "5mm" "6mm" "7mm" "8mm"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">axes_add_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggpLayerAxesSI.html">ggpLayerAxesSI</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rect_add_on</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerRect.html">ggpLayerRect</a></span><span class="op">(</span></span>
<span>    object <span class="op">=</span> <span class="va">object_t275</span>, </span>
<span>    xrange <span class="op">=</span> <span class="va">xrange</span>, </span>
<span>    yrange <span class="op">=</span> <span class="va">yrange</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">rect_add_on</span> <span class="op">+</span></span>
<span>  <span class="va">axes_add_on</span> <span class="op">+</span> </span>
<span>  <span class="va">text_size</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">object_t275</span>,</span>
<span>  xrange <span class="op">=</span> <span class="va">xrange</span>, <span class="co"># crop the image with distance input</span></span>
<span>  yrange <span class="op">=</span> <span class="va">yrange</span>  <span class="co"># crop the image with distance input</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">text_size</span></span></code></pre></div>
<p><img src="spatial-measures_files/figure-html/unnamed-chunk-7-1.png" width="50%"><img src="spatial-measures_files/figure-html/unnamed-chunk-7-2.png" width="50%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t275</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerAxesSI.html">ggpLayerAxesSI</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"mm"</span>, breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerSpatAnnOutline.html">ggpLayerSpatAnnOutline</a></span><span class="op">(</span><span class="va">object_t275</span>, ids <span class="op">=</span> <span class="st">"img_ann_1"</span>, fill <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerHorizonSAS.html">ggpLayerHorizonSAS</a></span><span class="op">(</span><span class="va">object_t275</span>, id <span class="op">=</span> <span class="st">"img_ann_1"</span>, distance <span class="op">=</span> <span class="st">"1mm"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/ggpLayerScaleBarSI.html">ggpLayerScaleBarSI</a></span><span class="op">(</span><span class="va">object_t275</span>, sb_dist <span class="op">=</span> <span class="st">"1mm"</span>, sb_pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5.5mm"</span>, <span class="st">"7.5mm"</span><span class="op">)</span>, text_size <span class="op">=</span> <span class="fl">15</span>, text_nudge_y <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="va">text_size</span></span></code></pre></div>
<p><img src="spatial-measures_files/figure-html/unnamed-chunk-8-1.png" width="50%"></p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-areas">4. Working with areas<a class="anchor" aria-label="anchor" href="#working-with-areas"></a>
</h2>
<p>In addition to distances, areas can be computed, too. This becomes
interesting, for instance, if the area of an image annotation is of
relevance to the biological question.</p>
<div class="section level3">
<h3 id="handling-area-input-and-output">4.1 Handling area input and output<a class="anchor" aria-label="anchor" href="#handling-area-input-and-output"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validActivationFunctions.html">validUnitsOfArea</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "nm2" "um2" "mm2" "cm2" "dm2" "m2"  "px"</span></span></code></pre>
<p>Pixel are by definition squares which means that all sides are of the
same length. This property is used in SPATA2 to use pixel as a unit of
distance. It can, however, be a unit of area, too. E.g. 4px with a side
length of 1um cover an area of 4um2 or an area of 4px. However, the
number of pixels that cover a specific area again depends on the
resolution of the image. Again, SPATA2 implements SI units of area.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validActivationFunctions.html">validUnitsOfAreaSI</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "nm2" "um2" "mm2" "cm2" "dm2" "m2"</span></span></code></pre>
<p>Pixel is not among them. SPATA2 allows resolution dependent
conversion from pixel to SI units and vice versa. As pixel are squares
of equal sizes the scale factor used for distance conversion can be used
in its squared form.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPixelScaleFactor.html">getPixelScaleFactor</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"um2"</span>, img_name <span class="op">=</span> <span class="st">"lowres"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 187.2323</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "um2/px"</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># more um2 per pixel in the very low resolution image </span></span>
<span><span class="co"># -&gt; pixels are smaller</span></span>
<span><span class="fu"><a href="../reference/getPixelScaleFactor.html">getPixelScaleFactor</a></span><span class="op">(</span><span class="va">object_t275</span>, unit <span class="op">=</span> <span class="st">"um2"</span>, img_name <span class="op">=</span> <span class="st">"very_low_res"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6231.843</span></span>
<span><span class="co">## attr(,"unit")</span></span>
<span><span class="co">## [1] "um2/px"</span></span></code></pre>
<p>Functions that convert areas are named similar to those that convert
distances. If pixels are involved, the <code>SPATA2</code> object must
be specified as the scale factor is needed.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># numeric input is interpreted as pixel</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_millimeter2</a></span><span class="op">(</span>input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">4000</span>, <span class="fl">50000</span><span class="op">)</span>, object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [mm^2]</span></span>
<span><span class="co">## [1] 0.03744645 0.07489290 0.74892903 9.36161289</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if character, different units can be specified as input</span></span>
<span><span class="fu"><a href="../reference/as_unit.html">as_centimeter2</a></span><span class="op">(</span>input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"4mm2"</span>, <span class="st">"400px"</span><span class="op">)</span>, object <span class="op">=</span> <span class="va">object_t275</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [cm^2]</span></span>
<span><span class="co">## [1] 0.040000000 0.000748929</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="examples-1">4.2 Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># process the diet example object</span></span>
<span><span class="va">object_t313</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyTissueOutline.html">identifyTissueOutline</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">object_UKF313T_diet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set ids of example spatial annotations</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"necrotic_area"</span>, <span class="st">"necrotic_edge"</span>, <span class="st">"necrotic_edge2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotSpatialAnnotations.html">plotSpatialAnnotations</a></span><span class="op">(</span><span class="va">object_t313</span>, ids <span class="op">=</span> <span class="va">ids</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-measures_files/figure-html/unnamed-chunk-13-1.png" width="TRUE"></p>
<p>Compute the area that is covered by the tissue sample. Note that
tissue area is computed by tissue section which requires the tissue
outline as computed by <code><a href="../reference/identifyTissueOutline.html">identifyTissueOutline()</a></code>. Note that
when the tissue outline computed with the observations is used the
returned area is an approximation of what can be seen on the image.
Using <code>method = 'image'</code> gives slightly more exact outputs if
the tissue is appropriately recognized.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># process the diet example object</span></span>
<span><span class="va">object_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/loadExampleObject.html">loadExampleObject</a></span><span class="op">(</span><span class="st">"LMU_MCI"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">object_mouse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identifyTissueOutline.html">identifyTissueOutline</a></span><span class="op">(</span><span class="va">object_mouse</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get tissue area by tisse section</span></span>
<span><span class="fu"><a href="../reference/getTissueArea.html">getTissueArea</a></span><span class="op">(</span><span class="va">object_mouse</span>, unit <span class="op">=</span> <span class="st">"mm2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [mm^2]</span></span>
<span><span class="co">## tissue_section_1 tissue_section_2 </span></span>
<span><span class="co">##         6.349445         7.945489</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getTissueArea.html">getTissueArea</a></span><span class="op">(</span><span class="va">object_t313</span>, unit <span class="op">=</span> <span class="st">"mm2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 29.67623 [mm^2]</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># left </span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_t313</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/ggpLayerTissueOutline.html">ggpLayerTissueOutline</a></span><span class="op">(</span><span class="va">object_t313</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># right</span></span>
<span><span class="fu"><a href="../reference/plotImage.html">plotImage</a></span><span class="op">(</span><span class="va">object_mouse</span>, unit <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/ggpLayerTissueOutline.html">ggpLayerTissueOutline</a></span><span class="op">(</span><span class="va">object_mouse</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial-measures_files/figure-html/unnamed-chunk-14-1.png" width="50%"><img src="spatial-measures_files/figure-html/unnamed-chunk-14-2.png" width="50%"></p>
<p>Compute the area that is covered by different image annotations and
filter accordingly. Extracting the values can be used for further
subsetting.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the three necrotic ids from above</span></span>
<span><span class="va">spat_ann_areas</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/getSpatAnnArea.html">getSpatAnnArea</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object_t313</span>, ids <span class="op">=</span> <span class="va">ids</span>, unit <span class="op">=</span> <span class="st">"mm2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spat_ann_areas</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [mm^2]</span></span>
<span><span class="co">##  necrotic_area  necrotic_edge necrotic_edge2 </span></span>
<span><span class="co">##      6.1849516      0.4618869      0.6252351</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, value <span class="op">=</span> <span class="st">"mm2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep only those with an area smaller than 1mm2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spat_ann_areas</span><span class="op">[</span><span class="va">spat_ann_areas</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [mm^2]</span></span>
<span><span class="co">##  necrotic_edge necrotic_edge2 </span></span>
<span><span class="co">##      0.4618869      0.6252351</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jan Kueckelhaus, Dieter-Henrik Heiland.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
